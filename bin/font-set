#!/bin/bash

# Escape any special characters in the new font name to avoid regex issues
new_font=$(printf '%s' "$1" | sed 's/[][\/.^$*]/\\&/g')

if [[ -n "$new_font" && "$new_font" != "CNCLD" ]]; then
  if fc-list | grep -iq "$new_font"; then
    sed -i "s/\(family = \)\"[^\"]*\"/\1\"$new_font\"/g" ~/.config/alacritty/alacritty.toml

    sed -i -E "s/^[[:space:]]*(font *= *)(.*)([[:space:]]+[[:digit:]]+)/\1$new_font\3/" ~/.config/dunst/dunstrc
    sed -i "s/font-family: .*/font-family: '$new_font';/g" ~/.config/waybar/style.css

    xmlstarlet ed -L \
      -u '//alias[family="monospace"]/prefer/family' \
      -v "$new_font" \
      ~/.config/fontconfig/fonts.conf

    fc-cache -f
    notify-send "System font updated to $new_font"
  else
    echo "Font '$new_font' not found."
    exit 1
  fi
else
  echo "Usage: omarchy-font-set <font-name>"
fi
