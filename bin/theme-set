#!/bin/bash

# theme-switcher
#
# Interactive theme switcher with state persistence

# --- Configuration ---
STATE_DIR="${XDG_STATE_HOME:-$HOME/.local/state}/current"
CURRENT_LINK="$STATE_DIR/theme"
THEME_DIR="$XDG_CONFIG_HOME/themes"

# --- Input Validation ---
if [[ -z "$1" ]]; then
  notify-send -a "theme-switcher" "No theme name provided"
  exit 1
fi

# --- Ensure State Directory Exists ---
if [[ ! -d "$STATE_DIR" ]]; then
  mkdir -p "$STATE_DIR"
  notify-send -a "theme-switcher" "Created state directory: $STATE_DIR"
fi

# --- Theme Name Processing ---
# Convert the input theme name to a directory-friendly format.
# 1. Strip leading/trailing whitespace
# 2. Convert to lowercase
# 3. Replace spaces with hyphens
THEME_NAME=$(echo "$1" | sed 's/^[[:space:]]*//;s/[[:space:]]*$//' | tr '[:upper:]' '[:lower:]' | tr ' ' '-')
THEME_PATH="$THEME_DIR/$THEME_NAME"

# --- Theme Validation ---
# Check if the theme directory exists.
if [[ ! -d "$THEME_PATH" ]]; then
  notify-send -a "theme-switcher" "Theme '$THEME_NAME' does not exist in $THEME_DIR"
  exit 1
fi

# --- Create Symlink ---
# Update the `current` symlink to point to the selected theme.
ln -nsf "$THEME_PATH" "$CURRENT_LINK"

# --- Force Alacritty to reload ---
theme-set-terminal

# --- Reload hyprland ---
hyprctl reload
