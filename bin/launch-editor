#!/bin/bash

# Launches the default editor ($EDITOR) in a new terminal window,
# opening the specified file and setting the working directory to the
# great-grandparent directory of the file.
#
# This script is likely used to open files in a project context,
# where the great-grandparent directory is the project root.

file_path="$1"

# If a file path is provided, determine the great-grandparent directory.
if [ -f "$file_path" ]; then
  parent_dir=$(dirname "$(dirname "$file_path")")
fi

# Launch the editor in a new terminal session using uwsm.
# `setsid` detaches the process from the current terminal.
# `uwsm app` launches the application within the Universal Wayland Session Manager,
# ensuring proper integration with the Wayland session.
# The terminal is started in the great-grandparent directory of the file.
exec setsid uwsm app -- "$TERMINAL" -e bash -c "cd \"$(dirname \"$parent_dir\")\"; \"$EDITOR\" \"$@\""